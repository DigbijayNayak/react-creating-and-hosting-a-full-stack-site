# Creating a Node.js Back End

## 1. Why Node.js?

- All right, so now that we've got our client side working nicely, it's time to start building the backend of our blog. And to do this, we're going to be using Node.js. Now, you've probably already heard about Node.js by now and you should have it installed locally on your computer.
- If you don't, you're going to want to head to nodejs.org and download the Long Term Support or current version of Node.js. And Node.js is really important for us because it allows us to write our backend in JavaScript instead of in PHP or Python or Java.
- Right, as I said in the introduction, it used to be that in order to be a full stack developer you had to be fairly fluent in more than one programming language, but with Node.js, which has become an incredibly popular framework since it was released, our entire web application can now be written in JavaScript, which is great news for JavaScript developers like us.
- Now, there are many different npm packages that can be used to create Node.js servers. And the one we're going to be using in these videos is called Express. Now, Express is a great choice for us because it's unopinionated, it's very easy to get started with, and it's also very well documented and you can feel free to take a look at the documentation for Express just by going to expressjs.com and looking at the API reference.
- And in addition to this, there are a ton of third-party add-ons that can be used to extend Express's functionality, which, as we'll see later on, can really come in handy. So without further ado, let's get started creating our backend with Node.js in Express.
- https://nodejs.org/en/docs
- https://expressjs.com/en/4x/api.html

## 2. Setting up an Express server

- All right. To get started creating a backend for our app with NodeJS and Express, what we're going to do is create a directory outside of this front end directory that we've been working with so far, right? That we called my blog. So what you're going to want to do is open up a terminal and type CD and then dot. And that will send you back out into the parent folder.
- And then what we're going to do is just create a new folder inside of here alongside our my blog directory. And we'll call that something like my blog backend. So what you're going to do for that, assuming of course that you're on Mac this may well be different if you're on Windows. So just look up how to create a new directory in Windows or whatever operating system you're on.
- And then you're going to say my blog backend, right? So this is the name that you want for the directory. Okay, so once we've created that, we're just going to open that up in visual studio code and you can either do that just by going to file open in visual studio code.
- Or if you have your terminal setup to do this, you can just say code and then my blog backend, and that should open it for you in a new window. Okay, so we now have this nice empty directory. And what we're going to do here is initialize this as a new NPM package. And the way that we can do that is again by opening a terminal here and running the command `npm init -y` which will do things like create a new package.json file inside our folder and help us keep track of different things about our backend project. All right.
- So once we've done that, the next thing that we're going to do is install the express package which we're going to be using to build our server. And the way we're going to do that is by running the command `npm install express`, and hitting enter, and that should install express for us. And the next thing that we're going to do now is create a source folder where we'll be storing all of our source codes. So what we're going to do is just right click inside of here and do new folder.
- And we'll just call this folder source. And this will contain all of our server side code. And the last file that we're going to need to create here is a file called server.js. And this is where we're going to be writing all of our server code, but before we write our server code, what we're going to want to do is set up this project so that we can use modern JavaScript, syntax such as the import and export syntax. And in order to do that, this used to actually be a lot more complicated.
- You used to have to install Babel and set up a Babel RC but now all you have to do in order to make that syntax work, is go into your package.json file and add a single property to that called type. And the value for that is going to be module and make sure that you add a comma on the end of that line, because if not, it will cause an error. Like this `"type": "module",`. Cool, so now that we've added that we can start creating our new express server inside this server.js file. So this is a pretty straightforward thing to do.
- And what we're going to do as an example, is we're just going to create a very simple express server that sends us a message when we send a request to it. So the first thing that we need to do here is import the express package that we just installed. And we can do that by saying `import express from 'express'`. And after we've done that, we're going to create a new express app by saying const app equals.
- And then we're going to say express and call that as a function like this `const app = express();`, which will create a new express app for us. Okay, so now that we have this app object, we can define different end points and what we want our server to do when one of those endpoints receives a request. So let's start off very simply, let's make it so that when our app receives a get request on an endpoint slash hello, it will simply respond with a message saying, hello. Like this

  ```js
  app.get("/hello", (req, res) => {
    res.send("Hello!");
  });
  ```

- All right, pretty simple, straightforward. It's a good hello world program to do. Okay, so in order to make our express app do that, all we have to do is say app.get, this is the type of the request here. And then app.get takes two arguments. The first one is going to be the route, right? The specific path that we want to listen for. And the second argument here is a callback that gets called whenever this endpoint receives a request. So this callback has two main arguments. The first one is a request object which contains details about the request that we received.
- And the second one is a response object which we can use to send a response back to whoever sent the request. Okay, so for our purposes, what we're going to do is just say request a response. And the body of this callback function is just going to say response.send and we'll send back the message, hello, okay? And response.send here is one of several functions that we can use to send back a response in this case, a response as you can see is just the string hello. Okay, so we've defined the endpoint behavior.
- So the last thing that we have to do is tell our server to listen, and this is going to be done by saying app.listen. And this function takes an argument to specify which port we should listen on. So we'll just do 8,000 here. And it's also going to take a callback that will get called once the server is actually listening. And we usually just use this to log out a message to the console saying that the server is listening. So inside here, we can just say console.log. And we'll say, server is listening on port 8,000. (keyboard clicks) Okay, and that's all there is to it. All we have to do now is use NodeJS to run our express server. And the command that we have to use for that, is `node src/server.js`.
- And if we hit enter now, we'll see that it says server is listening on port 8,000. And what we should be able to do now is go over to a browser and enter in local host 8,000 slash hello and hit enter. And what we'll see sure enough is the response that we got from the server saying hello. So everything's working great so far. Next, we're going to see how we can actually make our app do some useful things. And we're also going to take a look at a better tool for testing our server.

## 3. Testing an Express server with Postman

- All right. So we've created a very simple express server, and as we move forward with our server development, it's going to be very important for us to have an easy and reliable way to test it. So far, what we've done is we've just typed the URL into our browser and this has worked but for some of the more complicated operations we're going to want to implement, this isn't going to be quite good enough.
- So what I'm going to recommend you do is head over to postman.com/downloads and download a piece of software called Postman, which is a very, very helpful program for testing servers as you're building them. And this is what it looks like when you open it up.
- So once you've downloaded and installed Postman, let's use it to actually query our backend. So what we're going to do is run our server. If you have your server running, that's great. If you don't have it running you're going to want to run it again with node source/server.JS, and make sure that it logs out server is listening on port 8000.
- And then what you're going to do is open up Postman and we'll use it to send a get request to the Hello endpoint. And the way that you do this is by clicking on the little plus button up here. And that might be in a different place depending on if Postman is updated. But anyway, just find a way to get this window up. And what you're going to do in here is type in HTTP, colon slash slash local host 8000/hello and notice over here that we have get selected.
- There's all different types of requests that you can select from this, and we'll get to that shortly. But for now, let's just send a get request to that endpoint that we created on our server and what we should see if we click the send button, is sure enough we get back this response Hello. All right. So that's the basics of using the Postman tool.
- There are obviously a lot more things that you can change about the request that you're sending and we'll get to those shortly. But first let's talk a little bit about making different types of requests in Postman. Now, for those of you who aren't familiar with different types of requests, such as get and post and all of the other ones that are in here, all you need to know for this course is that get requests are used to load information, usually from the server, such as an article content or a user's information and post requests, if you select that from the dropdown here, post requests are usually used to create some sort of new resource on the server.
- And there is one last type of request that we're going to be using and that is a put request. Put requests are usually used to update data on the server. Okay, so we're going to be using all of these as we develop our backend and bring it together with our front end. But before we can effectively use post requests and put requests, what we're going to want to do first is actually get a little bit of experience with these requests because they're a little bit different from just sending a basic get request.
- A get request, as we saw, basically just sends a simple request to a specific path, as we saw and usually it will get back some sort of response. However, post requests and put requests have the ability to carry extra information in something called a request body or request payload.
- So let's take a quick look at an example of making a post request to our server and actually including a payload. So what we're going to do is just select post from the dropdown. And before we add any extra body to this request, let's just try sending a post request to our server and see what happens if we send it to the same path that we defined our route handler for earlier. Okay. If we click send, what you're going to see is that we get back this HTML basically telling us that there was some kind of error on the server and specifically it says, cannot post Hello.
- So when we create the different endpoints on our server, like this one here, where we said app.get, these endpoints are only going to respond to the specific type of request that we selected. So in other words, if we want this to respond to a post request, we need to change it to app.post. And this is just something that express does for us. It's a really nice API to work with just because it makes it so simple to tell whether an endpoint is a post endpoint or a get endpoint or a put endpoint.
- So if we restart our server, and you do have to manually restart your server here in order for these changes to take effect, we'll take a look at how to add the ability to automatically restart your server very shortly. But now if we go back over to Postman and click send and send a post request to that endpoint we'll see that we get back that same request. And likewise, if we try and send a get request to that endpoint now we'll see that we get the error saying cannot get Hello.
- So anyway, the point of all of this is that when you define your different endpoints you need to be aware of what method get post put or any of these other ones you're using when you define them so that you can know what type of request to send to that endpoint. So now that we've seen how to send post requests and define post request handlers on the server, let's actually try sending some extra information in the form of a request body. And the way that you do this in Postman is by selecting this body tab here and then you're going to select raw. And from the dropdown here, you're going to select JSON.
- So we're going to be sending a request that contains JSON data to our server. And what we're going to do in here is just provide some very simple data. We're going to say name, and I'm just going to use my name here. Although you should definitely feel free to use your own name. And let's click send now. And what we should see is that we just get back the regular response.
- So our server isn't doing anything with this request body yet. So let's head back over to our server. And when you define a post endpoint like this one here, usually what you'll want to do is get access to that information in the request body. So the way that you do that is by saying request.body, we're using this request argument here and we're just taking a look at its body property. And if we log this out right now what you're going to see, if we restart our server here and we'll go back to Postman and click send. If we go back now to our terminal what we're going to see is something kind of strange. It says undefined. Now this is something that really tends to confuse people who are new to know JS.
- In order for the body property to work correctly in an express application, we have to add a little piece of what's called middleware to our app. Basically middleware is just extra functionality that our server will automatically execute. And what it's going to look like is this. We're going to say app.use... And this does have to be above where we define our endpoints.
- We're going to say app.use and then express.JSON. So basically what this line is telling express to do is when it receives a request that has a JSON body, a JSON payload, it's going to parse that and automatically make that available to us on request.body. So now if we restart our server again and go back to Postman, click send and then go back and take a look at our terminal here, we should see that now we have that object that we included in Postman. Okay.
- So one last thing. Let's just make this Hello endpoint say Hello to the person, to the name that is specified in the request body. For that all we need to do is say hello and then we'll change these to back ticks here so that we can insert the value of that variable. So we'll say request.body.name. And if we restart our server once more here, we should be able to go back to Postman and click send and see that it says, hello and well, mine says Sean, but yours should hopefully say your name. Alright. So that's how to handle post requests and take a look at the body. Obviously, this is a very simple example, but as we move on we're going to see some very useful situations where things like post requests and request bodies will come in handy.

## 4. URL parameters in Express

- So at this point we've seen how to use post requests to carry extra information in the form of a JSON object with the requests that we send to our server. Right? So we were able to send our name to the server and correctly parse that and include that in the response that our server sends back. Now, this is generally considered to be the best way to add information to our requests, especially complex information, but there are several other ways to do this. Okay.
- Before we move on to implementing things like up voting or comments for our blog site what we're going to do is take a backward look at a concept that we learned when we were implementing the article pages in our front end. Okay. So you might remember that for the article pages on our front end, and I'm just going to type this here, in order to take a look at a specific article we had to go to local host 8,000 or 3,000. It was slash, and then it would be slash articles slash learn node, for example. Okay?
- Now remember that this second part of the URL was what was called a URL parameter and the way that we used it was our page, right? The article page component was able to look at this thing and use it to load the corresponding article data. Now it just so happens that on the server we'll generally want to be able to do the same kind of thing. Right?
- In other words, when we create an endpoint that will allow users to up vote a given article, well, what we're going to want to do is allow the front end to send a post request or a put request in this case would be a little more accurate to something like slash articles, slash, and then if they want to up vote the learn react article they would say slash learn react, and then maybe you would have an extra segment here that would say up vote that would actually, you know, specify that we want to up vote that article. Okay.
- So in order to be able to do this, we need to know how to work with parameters in Express. And the good news here is that it's fairly straightforward. All we have to do is when we're creating an endpoint, right? So let's just say that we want to create a get endpoint that will say slash hello and say hello to the person's name, using URL parameters, instead of a request body.
- All we have to do in order to specify that we want a URL parameter in this route is say colon and then, you know, whatever we want to call the URL parameters. So if we want to call this name, it would look like that. If we want to call it person name or who to greet, right? You can call it whatever you want. And that's just going to determine what the property is called on the request object as you'll see, but for now let's use name and what we're going to do is add a callback for this.
- It's going to look just the same as the one that we defined for our post endpoint. And then inside here, what we're going to do is get the name by saying const name equals request dot params. All right? So request dot params is going to give you an object containing all of the URL parameters inside of here and their values and then we're going to say dot name.
- Now, if you want to make this even shorter you can use object de structuring and just say const and then put name and curly braces there equals request dot params. And that's generally what you'll see done just because it's a little bit shorter. Okay.
- So now that we have the name, let's just send back a response and we'll say response dot send. And again, we'll use back ticks and say hello and then we'll just insert the name there. Okay? And here we'll put two exclamation points here instead of one, just so we know that it is in fact this endpoint that's responding when we send a request to it from postman. Okay?
- So now that we've created that endpoint all we need to do is restart our server by saying node source slash server dot js and hitting enter. We should see that our server is listening. So let's head back to postman. There it is. And we're going to send a get request now to this new URL parameter route that we just created. So we'll say slash hello slash Sean.
- And then just to prove that the request body isn't involved at all let's just remove that. I'm just going to delete everything here. And if we click send now, we'll see that it says, hello, Sean, with two exclamation points. So anyway, that's the basics of using URL parameters in Express and what we're going to be doing as I've hinted is using this sort of functionality to allow users to up vote different articles and add comments to different articles.
- So, one last thing that I want to show you though, is that it is indeed possible to have multiple URL parameters. And, you know, if we were to say, hello, slash, name and then goodbye, slash, other name, just as an example, what you're going to see if we log out the request dot params object, by saying console dot log request dot params, all right? And then we'll have to restart our server again of course, I'll show you how to get around this shortly. All right, so if we go back to postman now and change this URL up here, we'll say slash, hello, Sean.
- And then we'll say slash, goodbye, John. Okay? If we click send now what we'll see is that sure enough we get that response back, but more importantly if we go back and take a look at the terminal here, we'll see that sure enough the request dot params object contains all of the keys, right? Which are the names that we gave to the URL parameters and the corresponding values that were at that segment in the URL. So that's how URL parameters work in Express. Let's just change this back to hello name and we'll get rid of this. And that will give us our original functionality back.

## 5. Upvoting articles

- All right now that we've seen some basic examples of how an express server works let's make our server actually do something more relevant to our blog. What we're going to want is for our users to be able to upvote our articles to help other users see which of our articles is the most popular or most helpful. Right? So in order to do this we're going to need to add some more code to our back end. And first of all what we're going to do is just remove these hello endpoints.
- You can feel free to comment them out if you want but I'm just going to remove them to keep everything clean. And what we're going to do here is create an upvote endpoint that will look something like this. We're going to say app dot put and the actual path that we're going to use here is going to be slash API. All right. And yes, this is something new here.
- I'll talk about that in more detail later on. So for now don't worry about it. And then after that we're just going to have what you would expect and say slash articles slash colon name. All right. So that's going to be the name of the article that we want to upvote and then we're going to say slash upvote. Cool. So now that we have that let's just define the callback for this route handler.
- We're going to say request and response. And inside here is where we're going to put the logic for actually upvoting different articles. Now, before this will actually work. what we're going to need to do is define a sort of fake database in our server that will keep track of how many upvotes each article has, right? Later on, we're going to be replacing this, of course with an actual database like MongoDB, but for now this will help us to at least get the logic right in each of our route handlers.
- So up here at the top, what we're going to do is define a new object, which we'll call articlesInfo and what this is going to look like, it's going to be an array of objects, each of which is going to represent a different article and keep track of how many upvotes that article has. All right. So inside each of these objects, we're going to have the name of the article, right? So learn-node for example, or learn-react I believe was the first one.
- And then after that, we're just going to keep track of how many upvotes that article has. So we're going to start each of our articles off at zero upvotes. So now let's just do the same thing for our other articles. We're going to create one for the learn-node article. That one will start off with upvotes equal to zero and last but not least, we're going to create one for the Mongo article.
- So we'll just say mongodb for the name and the upvotes for that one is going to be zero as well. Okay. So again, this is just going to serve as a temporary in-memory database that will make development much easier. And then later on, we're going to come back and actually replace this with MongoDB. So let's head down now to this endpoint that we created.
- And the first thing that we're going to need to do is based on the value of the URL parameter, we're going to need to figure out what article we need to upvote. And once we figure that out we're going to need to actually increment the number of upvotes on that article's object in our database. So first things first let's find out what article we actually want to upvote. And the way that we're going to do that is by using the request argument here.
- So in order to get the value of this name URL parameter in the URL, what we're going to do is just say const name equals request dot params. All right, that will give us the current value that's at that name segment here in the requests that we just received. Cool. So once we have the name the next thing that we have to do is actually find the corresponding article with that name and what this is going to look like is we're just going to use JavaScript's built in find function.
- And we'll say const article equals articlesInfo dot find. And we want to find the article in here which we can just call a whose name property is equal to this name property URL parameter that we just parsed up here. Okay. So we're moving right along. We now have the article that we wanted to upvote in the first place. So the next thing that we need to do is say article dot upvotes plus equals one. So we're incrementing the upvote property on that article that we found.
- And yes, it probably would be a good idea to make sure that that article exists as well. So what we'll do is just say if article then article dot upvotes plus equals one. And for now let's just send back a response to the client saying something like the article now has four upvotes or something like that.
- So in order to do that, we'll just say response dot send and in back ticks here, we'll say the, and then we'll say name article now has, and then we'll send back the new number of up votes by saying article dot upvotes upvotes. Okay. So it'll just tell us how many upvotes that article now has.
- Now in the case that the article doesn't exist, what we're probably going to want to do is let the client side know that that article doesn't exist. And the way that we're going to do that for now is just by saying response dot send. And we'll say that article doesn't, and we're going to need to use an escape character here. So just put back slash and then the single quote character and then we'll say doesn't exist and that's it. Okay. So that's pretty much all we need to do for this upvote endpoint for the time being.
- So let's actually test this thing out by restarting our server. Okay, we're going to stop it and run Node Source slash server dot JS again, to make all of those changes take effect. And if we go back now to postman, what we're going to want to do is send a put request to local host 8,000 slash API. Remember that we have this slash API in there and then slash articles and we'll try upvoting our learn-react article and then we'll say slash upvote. Okay. So if we click send now this should work.
- And what we should see down here is a message saying the learn react article now has one upvote. Okay. So let's click send and sure enough we'll see that that's the case. If we click send again, we'll basically see that that just keeps upvoting the article. So anyway, that's how to create a basic upvote endpoint using express and node.

## 6. Automatically updating with nodemon

## 7. Adding comments
