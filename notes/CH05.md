# Adding User Authentication with Firebase Auth

## 1 Why Firebase Auth?

- All right, so now that we've added MongoDB to our full stack application and we have pretty much our full front end and backend completed, the next thing that we're going to do is see how to add basic user authentication to our app. Now, adding user authentication from scratch is something that can be kind of difficult. And I actually have a course on that as well, if you want to check that out.
- So what we're going to be doing here is using a tool base called Firebase Auth or Firebase Authentication to make the job of adding Auth to our app much easier. Now, Firebase Authentication, basically what it does is it takes care of storing all of our users' information and passwords in a very secure manner for us, right. We can't even see our users' passwords. So basically this allows us to sort of piggyback off of Google's security practices, which I can almost guarantee are going to be much more strict than yours.
- Okay, so what we're going to be seeing how to do is create a Firebase Auth project and add a few users to it. And we're also going to see how to enable different sign-in methods, such as email and password sign-in. And then of course, we're going to see how to integrate all of this into our React app and also into our Node.js backend. So that's Firebase Auth, let's jump right in and get started.

## 2 Creating a Firebase project

- All right. So now that we've learned a little bit about what Firebase off is and why it can be helpful for us, the first thing that we're going to do here is we're going to set up a Firebase project so that we'll be able to link this project to our front and back ends as you'll see how to do later on. So what you're going to want to do is go to **console.firebase.google.com** and if you don't already have a Google account you're going to need to create one first of all. And once you've done that you might need to do some additional pieces of setup.
- Google will basically walk you through all of that just by going to this URL here. But anyway, after you've done all that setup what you should be able to do is see this screen here. And what we're going to want to do is add a new project. So we'll just click on this button here that says, add project. And your screen here might look a little bit different than mine, just because I have a lot of projects already on Firebase and you probably won't at this point.
- So let's just click on this add project button and what this is going to do is ask us for a few different pieces of information about our project. So the first one it's going to ask us is for a project name and you can really call this whatever you want, as long as it doesn't conflict with another project that you have. But in our case, let's just call it My React Blog. And then down here, what you're going to see is that Firebase automatically generates a random ID that incorporates this name into it.
- All right, and you can actually edit that as well but this does have to be unique across all of the projects on Firebase. So anyway, once we've typed that in, we're going to click the continue button and this is going to ask us if we want Google analytics enabled for our project. Now Google analytics is a very useful tool, but for now just to keep things simple and because we're not going to be talking about it at all, we're going to turn that off. And then we'll click on create project and we're going to see this little loading spinner while Firebase creates our project for us. And this should only take a few seconds here.
- Once it's done, we're going to see this little continue button and we'll just click on that. And that will take us to the console for our project. Now there's obviously a lot of stuff in this console here but don't worry too much about it because the only thing that we're really going to be using is this authentication thing over here. So what we're going to do is just click on authentication and that's going to bring us to the authentication console where we're going to click this get started button which should enable Firebase authentication for our project.
- Now in Firebase off, Firebase off provides a lot of different ways for us to allow users to authenticate in our applications, such as with their Google account, with their game center account, Microsoft account, et cetera. There's lots of options here, but for now, just to keep things simple, what we're going to do is use email password authentication.
- So what you're going to want to do is click on this under native providers. And that'll bring up this little window here that has different types of email password authentication that are available to us. And we're only going to enable this first one up here which is just basic email password authentication. So let's click on enable here and click save. And now we've turned on email password authentication for our project. Okay.
- So the next thing that we're going to want to do is go into this user's tab inside Firebase off and we're going to create a test user that we can use to actually log into our application once we add this to our front end react app. So what you're going to want to do is click add user and that's going to come up with a little modal window here that asks us for our email and password. And these don't have to actually be a real email and password.
- So I'm just going to enter in shaun@gmail.com and the password here, I'm just going to do Abc123 and we'll click add user. And that will create a new user for us. Now, remember what that password is because you're going to need it to log in later when we actually add Firebase off to our react app. But for now that should be all the basic setup that we have to do in order to get our Firebase project created and get Firebase off, up and running.

## 3 Adding Firebase Auth to React

- All right, so now that we have a Firebase project created, the next thing that we're going to want to do is actually connect this project to our React application, and once we've done that we'll be able to actually use Firebase to log in users and create new user accounts. All right, so what we're going to do is we're going to go back to the main console for our project that we created, and you can do that just by clicking on project overview here.
- And then, in the middle of this console what you're going to see is this message that says, get started by adding Firebase to your app, and down here, underneath that, it's got a few different options. Now, the option that we want to select here is web because, obviously, the app that we're going to add this to is a web application. Now, if we were creating an iOS app or an Android app or even a game using Unity or an app using Flutter, we would select one of these other options, but since we're working with React, we're going to select web.
- Now, if you click on this button, the next thing that it's going to ask you for is an app nickname. Now, this is really just an indicator to remind you what app this represents. So, you can literally call this anything. I'm just going to call it, React front end, all right? And once we've done that, we're going to leave this checkbox for Firebase hosting unchecked.
- We're going to be using a different Google product to host our app and let's click on register app. Okay, so once we've done that the next thing that it's going to do is it's going to spit out all of this code that we can copy and paste into our React app in order to have our app automatically connect to the Firebase project that we created. So, what we're going to want to do is follow the two steps that it has.
- The first one here is installing the Firebase package into our React app, which we'll do, and the second step here is copying and pasting some configuration code into our react app. So, first things first, let's install Firebase into our React app. What you're going to want to do is open up your full stack project and open up a terminal as well and go into the front end of that project by saying CD my blog, and once we've done that, we're going to install the Firebase NPM package by saying NPM install Firebase, okay? And once we hit enter, that will install the Firebase package for us.
- So, the next thing that we're going to want to do is copy and paste this code that Firebase gave us into our project. Now, you might be wondering where this code goes, and the answer to that is that it goes into the entry point of our React application. So, if you open up My Blog and go into source, the entry point for React app, right, the file that contains the most important code in our React app that starts off the entire rendering process is inside index dot JS.
- So, let's open up that file, and what we're going to do is above where we actually say cons root equals, blah, blah, blah, and then, say, root dot render, we're going to paste all of that code that we just copied from Firebase, and you can remove the comments if you want, although, they do contain valuable information in case you're wondering exactly what it is that we're doing here, but just to be clean, I'm going to remove all of those comments, and that's basically all we need to do to connect our React app to Firebase.
- So, let's talk a little bit about what's going on here exactly. What we're doing is we're importing this initialized app function from the Firebase package that we just installed, and all that that does is it takes this big Firebase config object that basically just contains several different IDs and public keys that our React application can use to connect to the project that we just created, right? So, there's just lots of different things in here.
- Don't worry too much about what each of these does exactly. But another thing that I wanted to point out too is these are all public keys. So, it's perfectly fine to commit these to GitHub. Whereas if these were private keys, as we'll see later on with our back end, you would not want to have these in a publicly accessible Git repo. All right, so now that we've done that and we've initialized our app with that configuration object, our React app should be all set to connect to our Firebase project, and one way that we can verify this, of course, is just by trying to run our front end and making sure that it works.
- So, let's say NPM run start, and if we hit enter, we're probably going to see an error saying that the front end can't proxy to local host 8000, but that's just because we don't have the back end running. What we're looking for are some more conspicuous errors about Firebase, specifically, and since we don't see any of those, it means that our app is correctly connecting to Firebase.
- So, before we move on, what I want to do is just sort of set the stage for a few more things that we're going to be doing as we start integrating Firebase into our app a little more, and this is going to involve creating two more pages, right? So, we're going to create a login page, which will allow users to log in who already have an account. And for users that don't have an account, we're going to create a create account page. So, what you're going to want to do is open up your file tree here and inside the pages directory, we're just going to create two more files.
- The first one is going to be called, login page dot JS, and the second page is going to be called, create account page dot JS, and we're not going to put anything in these yet. We're going to implement these a little later on, but in addition to these two pages, we're also going to want to create a custom hook that will make it much easier for us to find out what user is currently logged in, which is something that we're going to need to know in several of our applications, components, and pages.
- So, what we're going to do here is create a new folder called hooks and this is going to going to contain all of the custom hooks in our application. It's really only going to be one custom hook for now, and inside here we're going to create a hook called use user dot JS. Now, the idea of this custom hook is that inside a component we'll be able to say something like cons user equals use user and just have immediate access to that user object and see if the user's logged in. See what the user's ID is, see what their email is, et cetera.
- So, that's going to be the idea here, and this is something that we'll get to implementing later on as well. All right, so now that we have that custom hook created and we also have our login page and create account pages created, the next thing that we're going to do is just create a basic skeleton for these pages, all right? It's just going to be very similar to what we did with our applications pages, such as the homepage, where we just say welcome to the create account page, basically, and this will just make things easier later on and allow us to set up the routes for both of these pages.
- So, inside our create account page file what we're going to do is say const create account page, and this is just going to be a simple function component, and what it's going to do is just return an H1 heading that says create account, all right? And we're going to be adding the rest of this page underneath this a little later on. So, don't worry too much about it right now. And then, we'll say export default create account page.
- And once we've done that, we're just going to copy all of this code and go into our login page component and we'll just paste it there and change this, so that it's the login page. And for the H1 heading, we'll say, log in instead, and then, we'll say export default login page. Great, so we have our create account page and login page components created. So, the next thing that we're going to do is go into our app component, all right? So, we'll open up app JS and we're going to create new routes for both of those pages.
- So, let's say import login page from pages slash login page, and then, we'll import the create account page as well. We'll say create account page from pages slash create account page. And then, what we can do is underneath all of our other routes, we'll say route path equals slash login.
- And the element for this is just going to be the login page like so, and then, we'll have our create account page. For this one, we're going to say route path equals slash create account. And the element for this one is going to be the create account page, all right? So, let's just put that in there and close the tag and that should be all we need.
- So, let's test this out. Our React app should be running. So, what we can do now is open this up in a browser and we should be able to just put in local host 3000 slash login and see the login page. And then, we should be able to put in local host 3000 slash create account and see the create account page.
- And, obviously, both of these are just a simple heading for now, but very soon we're going to be adding much more functionality to these and allowing users to actually log in and create accounts with them. And that's what we have coming up next.

## 4 Build a login form

- Okay, now that we set up some of the basic groundwork for our login page, create account page, and custom hooks, the next thing that we're going to do is actually start implementing the login page. So let's open up the login page component, and that's going to be in pages, LoginPage.js. And implementing this page is going to be pretty straightforward.
- All we're going to have to do is add two basic inputs and obviously we'll need state variables to track those, and we're also going to have a button that will call the appropriate Firebase Auth method, and that's something that we'll see very shortly, so don't worry if you don't know what that method is. Cool, so, first things first, what we're going to need to do is add some state variables to our login page, so that we can keep track of the values in our inputs, very similar to what we did earlier with the add comment forms.
- So what we're going to do is say import, useState from 'react'. All right. And that's pretty much all we need to create the basic form, so inside our login page component now what we're going to do is create an email state and a password state, and those are going to keep track of the respective values in each input. So let's say const email and setEmail equals useState, and the initial value for this is going to be an empty string, and we're going to do something very similar for the password input, We're going to say const password and setPassword equals useState, and the initial value, for this one is going to be an empty string as well.
- Now, in addition to both the email and password states, we're also going to have a specific state variable that will keep track of any errors that occur while the user is trying to log in, right? So when we try and log in with Firebase if the user put in the wrong password, let's say, or if they entered in a username that's not an email, then we're going to want to display that error.
- So in order to do that, we're just going to have an error state variable, so we'll say const error and setError equals useState, and that's going to be an empty string as well. Cool, so now that we have these three state variables we should be able to create most of the interface for this login page. What we're going to do is inside a react fragment. All right, so we're not going to have a special surrounding div for this login page, we're going to keep this h1 Log In heading, and underneath that we're going to have our inputs. So we'll have two inputs, the first one will be the email input, so we'll come back to that in just a minute.
- The second one is going to be the password input, and that's obviously going to have type equal to password there for the type attribute, and we're also going to have a button underneath that, that will say, Log In, right? This will be the button that the user clicks when they've entered their information and want to log in. And lastly, underneath this login button we're going to have a link to the create account page, just in case the user doesn't have an account so that they can go over to that page and create their account. All right.
- So what that's going to look like, we're just going to import the link component from react-router-dom, alright? This is the same thing that we did when we created our nav bar. So let's say import Link, from react-router-dom, and then if we go back down here, we should be able to create a simple link that will take the user to the create account page by saying Link to, and the path here is going to be /create-account, right? That's the path that we gave to the route that we defined in our app component.
- And the text in here is going to be pretty straightforward, we're just going to say, Don't have an account? Create one here. Okay, and that will just be a simple link that the user can click to go to the create account page. Cool, so now that we have all of the basic elements in our login page, and actually there's one that we're missing and that's going to be the error, but we'll add that later on. The next thing that we're going to do is actually bind the values of these inputs to the values of the state variables.
- Now, this is something that we did earlier with our add comment form, so it's going to be a pretty straightforward process if you remember what that was like, or you could always open up the add comment form for reference as well. So what we're going to do is we're going to say placeholder, this will be the hint text that we display to the user, and for that, we're going to say Your email address, and then we're going to create the binding between this input and our state variables up here, by saying value equals email and onChange, whenever the user types something new into the input, we're going to say event setEmail to e.target.value.
- Again, this is the same thing that we did in our add comment form. So now that we have that input set up, the next thing that we're going to do is add our second input, and what this is going to look like, in addition to our type attribute, we're also going to pass a placeholder value and onChange attribute just like we did in the input above.
- So let's say placeholder and for our password, we're going to want to say something like Your password, and under that will create our binding by saying value equals password, and onChange equals event, setPassword to e.target.value, all right? So pretty straightforward and pretty much the same thing between both of these inputs. Awesome. So now that we have both of those inputs bound to the corresponding state variables, let's actually add this error in here, basically all that we're going to want to do, this error is just going to be an error string that we'll want to display to the user, and in order to do that underneath our h1 heading, we're just going to say if error exists, okay, and the way that we do this in react is just by saying error and then the double ampersand sign, then what we want to do is display a paragraph tag with a className of error, okay? That's just for styling purposes, that className, and then inside here we'll display the actual error message.
- So this here is only going to display our error if the error actually exists and has a value, and that's something that will happen as the result of actually trying to log the user in with the email and password. Cool, so at this point we have pretty much everything in our login page set up, except for the actual login process itself, right? Once the user enters in their email and password, and clicks on this button, that's when we're going to start using Firebase Auth to log the user in with those credentials. Now, in order to make this happen what we're going to need to do is up at the top of our login page, we're going to import two things from the Firebase Auth package and those are going to be a function called getAuth, and another function called signInWithEmailAndPassword, and perhaps you can guess what this second function does, it's name is pretty self-explanatory I think, and these are going to be imported from the firebase/auth package.
- This is just the auth section of the Firebase package that we installed earlier. Cool, so now that we have those two things what we're going to do is inside our login page component, we're just going to create a new function called logIn. and this is going to be a pretty straightforward function that our button down here will call when it gets clicked, okay? So inside here, all we need to do is call this signInWithEmailAndPassword function that we imported from Firebase, and we're going to call that with the email and password that the user entered, and that should be really all we need to do.
- So let's say await, signInWithEmailAndPassword, and the way that most of these Firebased functions work as you'll see is you need to pass a Firebase auth references as the first argument, and that's what this getAuth function is for, so in almost all of our functions you'll see getAuth called as the first argument to signInWithEmailAndPassword, and then the second and third arguments that we pass to this function are the email and password that the function is talking about, alright? So this function call here should successfully log in the user, provided of course that they've given us the right email and password, and if they haven't, what this function is going to do is throw an error.
- So what we'll want to do is wrap this in a try catch block, and inside the catch block we're just going to take whatever error was generated and set this error state to that value. You'll see what that looks like in just a minute. So let's just say, try and catch error, and then if there was an error we'll just say setError to e.message, alright? And that will just take the error message, which is a string, and set this error state to that string. So the last thing that we're going to want to do now, now that we're logging in the user with their email and password, if everything goes well, we're going to want to route the user to the homepage, or we could also route them to the articles page instead, I suppose, which might make a little bit more sense.
- So what we're going to do is in order to navigate programmatically in a React app, we need a custom hook from react-router-dom, and that custom hook is called useNavigate. Now you might be familiar with a react-router-dom hook called useHistory from an older version of react-router-dom, and useNavigate is a new hook that replaces that, right? So it makes it very easy to navigate programmatically just by calling a function. So the way that we use this hook, inside our login page, is we're going to say const navigate equals useNavigate, and then all we have to do is call navigate with the path that we want to send the user to.
- So if we want to send the user to the articles list page, we can just say navigate /articles, and that will send the user to the articles page once they log in. Cool, so that's our login function. The last thing that we have to do here now is actually call this function when the user clicks the login button, and in order to make that happen all we need to do is say onClick equals logIn. And that should be all we need to do for our login page, so let's test this thing out, and we can do that just by going over to our application.
- And it looks like we have an error here, and that's just because we used the awake keyword without adding async to this function. So, that's a pretty easy fix, we should just be able to go back to here and add async to our login function here, and if we go back to our browser now, we should see that our create account page is showing, that's not what we want to see though, we want to see our login page.
- So if we enter login up here at the top of the browser and hit enter, we should see our login page displayed rather nicely. Okay, so nothing is going to happen at this point if we enter in our email address and password, and that's something that we're going to have to take a look at next, alright? At some point we're going to have to implement that useUser custom hook that we created the file for earlier, that will allow our components to know when a user logs in and change the app accordingly.

## 5 Creating a custom auth hook

## 6 Build a create-account page

## 7 Adding Firebase Auth to Node.js

## 8 Protecting endpoints using auth-tokens

## 9 Protecting the upvote and comment endpoints

## 10 Making requests with auth tokens

## 11 Making interface adjustments for authenticated users
